---
// Layout.astro
import "../styles/tailwind.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { ClientRouter } from "astro:transitions";

const { title } = Astro.props;
---

<html lang="en">
<head>
<script is:inline>
(function () {
  const html = document.documentElement;

  // Apply saved theme BEFORE page renders
  const saved = localStorage.getItem("theme");
  if (saved === "dark" || (!saved && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
    html.classList.add("dark");
  } else {
    html.classList.remove("dark");
  }

  // Toggle on button click
  document.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-theme-toggle]");
    if (!btn) return;

    html.classList.toggle("dark");
    localStorage.setItem("theme", html.classList.contains("dark") ? "dark" : "light");
  });

  // Sync between tabs
  window.addEventListener("storage", (e) => {
    if (e.key === "theme") {
      if (e.newValue === "dark") html.classList.add("dark");
      else html.classList.remove("dark");
    }
  });

  // ⭐ Fix: Re-apply theme after Astro swaps the page (no full reload)
  document.addEventListener('astro:after-swap', () => {
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") html.classList.add("dark");
    else html.classList.remove("dark");
  });

})();
</script>

  <meta charset="UTF-8" />

  <title>{title ? title : "Triasoft Systems Engineering"}</title>
  <ClientRouter />
<link
  rel="icon"
  type="image/svg+xml"
  sizes="x16"
  href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='700  20 20'>
      <rect x='1' y='1' width='170' height='7' rx='1' fill='%233ad24d'/>
      <rect x='7' y='1' width='170' height='7' rx='1' fill='%2300a6a0'/>
      <rect x='7' y='7' width='170' height='7' rx='1' fill='%2319b7b3'/>
       
      
    </svg>"
/>
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
        name="description"
        content="TRIASOFT SYSTEMS ENGINEERING — Building robust, secure, and scalable software solutions."
    />
  <!-- Apply theme early to avoid FOUC -->
 
</head>
<body class="min-h-screen bg-background-light text-text-light dark:bg-background-dark dark:text-text-dark transition-colors duration-300">
  <Header />
  <main class="min-h-screen">
    <slot />
  </main>
  <Footer />
</body>
</html>
